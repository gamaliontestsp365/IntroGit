Modified from patch1
Modified from bug1
